# Spec
Raspberry Pi 4 Model B, 4GB RAM, BCM2711(4Core&Thread)
SanDisk Extreme | microSDXC UHS-I Card, 64GB
Raspberry Pi OS Lite (64-bit), 438MB, Kernel version: 6.6, Debian version: 12 (bookworm)
+ RTC 추가해야함

# 현장
네트워크 없음, 인터넷 불가능
크레인 탑에 설치하는 특성상 접근 어려움
설치시 수개월 또는 수년간 접근 안할수도 있음

# 전원 중단 대응 (베터리를 쓸 수 없는 환경)
- 오버레이 파일 시스템으로 microSD 보호
- DB 를 위한 공간은 파티션 나누고 마운트하여 디스크에 쓰기 가능하도록 함
- DB 는 배치프로세싱으로 일정시간마다 데이터를 쓰고, 캐싱없이 즉시 디스크에 씀(fs.fsync)
- 저널링(ext4)으로 DB의 안정성 추가 확보

- (추가)시스템 로그, 서버 로그 등을 일정시간마다 디스크에 쓰기. DB 배치와 겹치지 않도록 시간간격은 각각 소수를 이용
- (추가)필요하면 외장 저전력 SSD 사용 고려
- (추가)전원부 회로 보강 필요시 고려

# 365 24
- 재부팅 (정기적 & 리소스 모니터링하여 이상징후 발견시)
- Watchdog Timer
- PM2 자동실행&리로드
- 쿨링 팬/제어
- 로그 로테이트

# Network(Wifi, SSH)
development only
Wifi 자동 연결
Wifi 통한 SSH 접속
USB Cable 이용한 SSH 접속
Wifi, 블루투스 등 불필요한 장치 끄기

# GPIO
## pigpio
alert 은 수 마이크로초 단위로 뱐화를 감지하지만 이벤트 핸들러가 실행되는 타이밍의 오차는 1ms 까지 올라간다.
interrupt 받는게 합리적이나, 문제가 있어보임.
pigpio C 라이브러리는 /dev/gpiomem 같은 장치 파일에 접근하여 GPIO를 제어하는데,
이 장치 파일은 한 번에 한 프로세스만 안전하게 접근할 수 있도록 되어 있어 멀티프로세싱 까다로움.
시리얼을 읽는 프로세스에서만 사용.

## onoff
edge 는 수십 마이크로초 의 오차를 가지고 이벤트 핸들러를 실행할 수 있다.

# Receiver Status 신호 문제
- 디바운싱
- 타이머

# Serial Data
GPIO 2개(SYNC_CLK, SERIAL_DATA)이용
SYNC_CLK 의 상승엣지, 1200~1350bps

- onoff < node-libgpiod < pigpio
- child_process
- stdio(Uint8Array) < 프로세스간 공유메모리
- priority, scheduling policy

# Find SyncWord
각 SyncWord 사이의 Word 들을 전달. 4~6 Words.

# Validation
16 bits error limit

## Address

## Parity

## Reverse

# database
- Log-Structured File System
- binary
- 쓰기 복구 및 복원 전략
- 읽기 검사 전략
- 소켓

# USB
마운트(자동/수동), 권한, udev, 안전한 언마운트, 불안전한(강제) 언마운트

# 엑셀
1초마다 각 데이터들을 평균내서 출력.

# 다운로드
USB
스트림

# 상태체크 LED
라즈베리파이 부팅됨
서버 실행중
데이터 수신중
로깅중
USB연결
다운로드완료